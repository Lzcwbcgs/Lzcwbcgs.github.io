<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>C++游戏开发--提瓦特幸存者 | Lzcwbcgs</title><meta name="keywords" content="C++,游戏开发,easyx"><meta name="author" content="Lzcwbcgs"><meta name="copyright" content="Lzcwbcgs"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="C++游戏开发--提瓦特幸存者"><meta name="application-name" content="C++游戏开发--提瓦特幸存者"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="C++游戏开发--提瓦特幸存者"><meta property="og:url" content="http://example.com/2025/01/18/C-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E6%8F%90%E7%93%A6%E7%89%B9%E5%B9%B8%E5%AD%98%E8%80%85/index.html"><meta property="og:site_name" content="Lzcwbcgs"><meta property="og:description" content="目录 动画系统设计 玩家控制系统 敌人生成系统 碰撞检测系统 UI系统设计 游戏循环架构 源代码展示   一、动画系统设计1.1 设计思路目标：实现多帧动画的加载和流畅播放 关键问题：  如何高效管理多张图片资源？ 如何控制动画播放速度？  解决方案：  使用 Atlas 类统一加载和管理动画帧 使"><meta property="og:locale" content="en"><meta property="og:image" content="http://example.com/images/text01.png"><meta property="article:author" content="Lzcwbcgs"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/images/text01.png"><meta name="description" content="目录 动画系统设计 玩家控制系统 敌人生成系统 碰撞检测系统 UI系统设计 游戏循环架构 源代码展示   一、动画系统设计1.1 设计思路目标：实现多帧动画的加载和流畅播放 关键问题：  如何高效管理多张图片资源？ 如何控制动画播放速度？  解决方案：  使用 Atlas 类统一加载和管理动画帧 使"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/01/18/C-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E6%8F%90%E7%93%A6%E7%89%B9%E5%B9%B8%E5%AD%98%E8%80%85/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: Lzcwbcgs","link":"Link: ","source":"Source: Lzcwbcgs","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Lzcwbcgs',
  title: 'C++游戏开发--提瓦特幸存者',
  postAI: '',
  pageFillDescription: '目录, 一、动画系统设计, 1.1 设计思路, 1.2 代码实现, 资源管理类 (Atlas), 动画播放类 (Animation), 二、玩家控制系统, 2.1 设计思路, 2.2 代码实现, 输入处理, 运动计算, 数学原理, 三、敌人生成系统, 3.1 设计思路, 3.2 代码实现, 生成位置计算, 自动寻路, 算法特点, 四、碰撞检测系统, 4.1 设计思路, 4.2 代码实现, 子弹与敌人碰撞, 玩家与敌人碰撞, 五、UI系统设计, 5.1 设计思路, 5.2 代码实现, 按钮基类, 开始游戏按钮, 结束游戏按钮, 六、游戏循环架构, 6.1 主循环结构, 七、源代码展示目录动画系统设计玩家控制系统敌人生成系统碰撞检测系统系统设计游戏循环架构源代码展示一动画系统设计设计思路目标实现多帧动画的加载和流畅播放关键问题如何高效管理多张图片资源如何控制动画播放速度解决方案使用类统一加载和管理动画帧使用类控制帧切换逻辑代码实现资源管理类构造函数根据格式化的路径加载序列帧示例会加载到格式化路径加载图片到内存析构时释放所有图像资源存储所有帧的指针动画播放类动画计时器动画帧索引二玩家控制系统设计思路目标实现流畅的键盘控制角色移动关键问题如何处理多键同时按下如何实现八方向移动的向量计算解决方案使用状态变量记录按键状态向量标准化处理移动方向代码实现输入处理处理键盘事件运动计算数学原理当同时按下两个方向键时通过向量标准化保证斜向移动速度与单方向一致例如同时按右和下时实际移动方向为右下度速度保持像素帧三敌人生成系统设计思路目标实现敌人从屏幕外随机生成并向玩家移动关键问题如何实现不同生成位置如何实现自动寻路解决方案随机选择生成边界上下左右使用向量计算朝向玩家的方向代码实现生成位置计算敌人生成边界将敌人放置在地图外边界处的随机位置自动寻路算法特点每帧重新计算方向实现实时追踪使用浮点数来进行计算保证了移动的平滑四碰撞检测系统设计思路目标实现精确的碰撞判定关键问题如何高效检测不同形状的碰撞如何处理不同物体的碰撞关系解决方案玩家与敌人点矩形碰撞子弹与敌人点矩形碰撞代码实现子弹与敌人碰撞将子弹等效为点判断点是否在敌人矩形内玩家与敌人碰撞将敌人中心位置等效为点判断点是否在玩家矩形内五系统设计设计思路目标实现交互式按钮关键问题如何检测鼠标悬停和点击如何显示不同按钮状态解决方案使用矩形区域检测鼠标位置维护按钮状态机普通悬停按下代码实现按钮基类开始游戏按钮结束游戏按钮六游戏循环架构主循环结构获取输入检测敌人和玩家的碰撞最终得分游戏结束检测子弹和敌人的碰撞移除生命值归零的敌人进行渲染七源代码展示当前帧索引玩家动画总帧数玩家移动速度玩家宽度玩家高度阴影宽度游戏窗口宽度游戏窗口宽度按钮宽度按钮高度加载玩家向左移动动画资源加载玩家向右移动动画资源判断游戏是否开始判断玩家是否奔跑绘制透明图像动画资源类动画计时器动画帧索引玩家宽度玩家高度阴影宽度敌人生成边界将敌人放置在地图外边界处的随机位置将子弹等效为点判断点是否在敌人矩形内将敌人中心位置等效为点判断点是否在玩家矩形内敌人宽度敌人高度阴影宽度开始游戏按钮退出游戏按钮生成新的敌人更新子弹位置径向波动速度切向波动速度子弹之间的弧度间隔当前子弹所在弧度值绘制玩家得分当前玩家得分获取输入检测敌人和玩家的碰撞最终得分游戏结束检测子弹和敌人的碰撞移除生命值归零的敌人进行渲染',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-01-24 12:37:29',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/images/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Lzcwbcgs</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="微信" src="/null"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/null"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Blog/" style="font-size: 1.05rem;">Blog<sup>1</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>1</sup></a><a href="/tags/easyx/" style="font-size: 1.05rem;">easyx<sup>1</sup></a><a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">游戏开发<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">January 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/C/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>C++</span></a><a class="article-meta__tags" href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>游戏开发</span></a><a class="article-meta__tags" href="/tags/easyx/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>easyx</span></a></span></div></div><h1 class="post-title" itemprop="name headline">C++游戏开发--提瓦特幸存者</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-01-18T11:55:48.000Z" title="Created 2025-01-18 19:55:48">2025-01-18</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-01-24T04:37:29.198Z" title="Updated 2025-01-24 12:37:29">2025-01-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="C++游戏开发--提瓦特幸存者"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">Post View:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为郑州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>郑州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/images/text01.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/01/18/C-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E6%8F%90%E7%93%A6%E7%89%B9%E5%B9%B8%E5%AD%98%E8%80%85/"><header><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a><a href="/tags/C/" tabindex="-1" itemprop="url">C++</a><a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" tabindex="-1" itemprop="url">游戏开发</a><a href="/tags/easyx/" tabindex="-1" itemprop="url">easyx</a><h1 id="CrawlerTitle" itemprop="name headline">C++游戏开发--提瓦特幸存者</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Lzcwbcgs</span><time itemprop="dateCreated datePublished" datetime="2025-01-18T11:55:48.000Z" title="Created 2025-01-18 19:55:48">2025-01-18</time><time itemprop="dateCreated datePublished" datetime="2025-01-24T04:37:29.198Z" title="Updated 2025-01-24 12:37:29">2025-01-24</time></header><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><a href="#%E5%8A%A8%E7%94%BB%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1">动画系统设计</a></li>
<li><a href="#%E7%8E%A9%E5%AE%B6%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F">玩家控制系统</a></li>
<li><a href="#%E6%95%8C%E4%BA%BA%E7%94%9F%E6%88%90%E7%B3%BB%E7%BB%9F">敌人生成系统</a></li>
<li><a href="#%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F">碰撞检测系统</a></li>
<li><a href="#UI%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1">UI系统设计</a></li>
<li><a href="#%E6%B8%B8%E6%88%8F%E5%BE%AA%E7%8E%AF%E6%9E%B6%E6%9E%84">游戏循环架构</a></li>
<li><a href="#%E6%BA%90%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA">源代码展示</a></li>
</ol>
<hr>
<h2 id="一、动画系统设计"><a href="#一、动画系统设计" class="headerlink" title="一、动画系统设计"></a>一、动画系统设计</h2><h3 id="1-1-设计思路"><a href="#1-1-设计思路" class="headerlink" title="1.1 设计思路"></a>1.1 设计思路</h3><p><strong>目标</strong>：实现多帧动画的加载和流畅播放</p>
<p><strong>关键问题</strong>：</p>
<ul>
<li>如何高效管理多张图片资源？</li>
<li>如何控制动画播放速度？</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>使用 <code>Atlas</code> 类统一加载和管理动画帧</li>
<li>使用 <code>Animation</code> 类控制帧切换逻辑</li>
</ul>
<h3 id="1-2-代码实现"><a href="#1-2-代码实现" class="headerlink" title="1.2 代码实现"></a>1.2 代码实现</h3><h4 id="资源管理类-Atlas"><a href="#资源管理类-Atlas" class="headerlink" title="资源管理类 (Atlas)"></a>资源管理类 (Atlas)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Atlas</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 构造函数：根据格式化的路径加载序列帧</span></span><br><span class="line">    <span class="comment">// 示例：path = &quot;img/player_%d.png&quot;，num = 6</span></span><br><span class="line">    <span class="comment">// 会加载 player_0.png 到 player_5.png</span></span><br><span class="line">    <span class="built_in">Atlas</span>(LPCTSTR path, <span class="type">int</span> num) &#123;</span><br><span class="line">        TCHAR path_file[<span class="number">256</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">            _stprintf_s(path_file, path, i);  <span class="comment">// 格式化路径</span></span><br><span class="line">            IMAGE* frame = <span class="keyword">new</span> <span class="built_in">IMAGE</span>();</span><br><span class="line">            <span class="built_in">loadimage</span>(frame, path_file);      <span class="comment">// 加载图片到内存</span></span><br><span class="line">            frame_list.<span class="built_in">push_back</span>(frame);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 析构时释放所有图像资源</span></span><br><span class="line">    ~<span class="built_in">Atlas</span>() &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; frame : frame_list) </span><br><span class="line">            <span class="keyword">delete</span> frame;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    std::vector&lt;IMAGE*&gt; frame_list;  <span class="comment">// 存储所有帧的指针</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="动画播放类-Animation"><a href="#动画播放类-Animation" class="headerlink" title="动画播放类 (Animation)"></a>动画播放类 (Animation)</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animation</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Animation</span>(Atlas* atlas, <span class="type">int</span> interval)</span><br><span class="line">	&#123;</span><br><span class="line">		anim_atlas = atlas;</span><br><span class="line">		interval_ms = interval;</span><br><span class="line">	&#125;</span><br><span class="line">	~<span class="built_in">Animation</span>() = <span class="keyword">default</span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Play</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> delta)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		timer += delta;</span><br><span class="line">		<span class="keyword">if</span> (timer &gt;= interval_ms)</span><br><span class="line">		&#123;</span><br><span class="line">			idx_frame = (idx_frame + <span class="number">1</span>) % anim_atlas-&gt; frame_list.<span class="built_in">size</span>();</span><br><span class="line">			timer = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">putimage_alpha</span>(x, y, anim_atlas-&gt;frame_list[idx_frame]);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">int</span> timer = <span class="number">0</span>;<span class="comment">//动画计时器</span></span><br><span class="line">	<span class="type">int</span> idx_frame = <span class="number">0</span>;<span class="comment">//动画帧索引</span></span><br><span class="line">	<span class="type">int</span> interval_ms = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Atlas* anim_atlas;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="二、玩家控制系统"><a href="#二、玩家控制系统" class="headerlink" title="二、玩家控制系统"></a>二、玩家控制系统</h2><h3 id="2-1-设计思路"><a href="#2-1-设计思路" class="headerlink" title="2.1 设计思路"></a>2.1 设计思路</h3><p><strong>目标</strong>：实现流畅的键盘控制角色移动</p>
<p><strong>关键问题</strong>：</p>
<ul>
<li>如何处理多键同时按下？</li>
<li>如何实现八方向移动的向量计算？</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>使用状态变量记录按键状态</li>
<li>向量标准化处理移动方向</li>
</ul>
<h3 id="2-2-代码实现"><a href="#2-2-代码实现" class="headerlink" title="2.2 代码实现"></a>2.2 代码实现</h3><h4 id="输入处理"><a href="#输入处理" class="headerlink" title="输入处理"></a>输入处理</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 处理键盘事件</span></span><br><span class="line">   <span class="function"><span class="type">void</span> <span class="title">ProcessEvent</span><span class="params">(<span class="type">const</span> ExMessage&amp; msg)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (msg.message == WM_KEYDOWN)&#123;</span><br><span class="line">		<span class="keyword">switch</span> (msg.vkcode)&#123;</span><br><span class="line">		<span class="keyword">case</span><span class="string">&#x27;W&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span> VK_UP:</span><br><span class="line">			is_move_up = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span><span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span> VK_DOWN:</span><br><span class="line">			is_move_down = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span><span class="string">&#x27;A&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span> VK_LEFT:</span><br><span class="line">			is_move_left = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span><span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span> VK_RIGHT:</span><br><span class="line">			is_move_right = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (msg.message == WM_KEYUP)&#123;</span><br><span class="line">		<span class="keyword">switch</span> (msg.vkcode)&#123;</span><br><span class="line">		<span class="keyword">case</span><span class="string">&#x27;W&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span> VK_UP:</span><br><span class="line">			is_move_up = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span><span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span> VK_DOWN:</span><br><span class="line">			is_move_down = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span><span class="string">&#x27;A&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span> VK_LEFT:</span><br><span class="line">			is_move_left = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span><span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">		<span class="keyword">case</span> VK_RIGHT:</span><br><span class="line">			is_move_right = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="运动计算"><a href="#运动计算" class="headerlink" title="运动计算"></a>运动计算</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> dir_x = is_move_right - is_move_left; </span><br><span class="line">	<span class="type">int</span> dir_y = is_move_down - is_move_up;</span><br><span class="line">	<span class="type">double</span> len_dir = <span class="built_in">sqrt</span>(dir_x * dir_x + dir_y * dir_y);</span><br><span class="line">	<span class="keyword">if</span> (len_dir != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">double</span> normalized_x = dir_x / len_dir;</span><br><span class="line">		<span class="type">double</span> normalized_y = dir_y / len_dir;</span><br><span class="line">		position.x += (<span class="type">int</span>)(SPEED * normalized_x);</span><br><span class="line">		position.y += (<span class="type">int</span>)(SPEED * normalized_y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (position.x &lt; <span class="number">0</span>) position.x = <span class="number">0</span>; </span><br><span class="line">	<span class="keyword">if</span> (position.y &lt; <span class="number">0</span>) position.y = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (position.x + FRAME_WIDTH &gt; WINDOW_WIDTH) position.x = WINDOW_WIDTH - FRAME_WIDTH; </span><br><span class="line">	<span class="keyword">if</span> (position.y + FRAME_HEIGHT &gt; WINDOW_HEIGHT) position.y = WINDOW_HEIGHT - FRAME_HEIGHT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="数学原理"><a href="#数学原理" class="headerlink" title="数学原理"></a>数学原理</h4><ul>
<li>当同时按下两个方向键时，通过向量标准化保证斜向移动速度与单方向一致。</li>
<li>例如：同时按右和下时，实际移动方向为右下45度，速度保持3像素&#x2F;帧。</li>
</ul>
<hr>
<h2 id="三、敌人生成系统"><a href="#三、敌人生成系统" class="headerlink" title="三、敌人生成系统"></a>三、敌人生成系统</h2><h3 id="3-1-设计思路"><a href="#3-1-设计思路" class="headerlink" title="3.1 设计思路"></a>3.1 设计思路</h3><p><strong>目标</strong>：实现敌人从屏幕外随机生成并向玩家移动</p>
<p><strong>关键问题</strong>：</p>
<ul>
<li>如何实现不同生成位置？</li>
<li>如何实现自动寻路？</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>随机选择生成边界（上下左右）</li>
<li>使用向量计算朝向玩家的方向</li>
</ul>
<h3 id="3-2-代码实现"><a href="#3-2-代码实现" class="headerlink" title="3.2 代码实现"></a>3.2 代码实现</h3><h4 id="生成位置计算"><a href="#生成位置计算" class="headerlink" title="生成位置计算"></a>生成位置计算</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 敌人生成边界</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">SpawnEdge</span> </span><br><span class="line">&#123;</span><br><span class="line">	Up = <span class="number">0</span>, </span><br><span class="line">	Down, </span><br><span class="line">	Left,</span><br><span class="line">	Right</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 将敌人放置在地图外边界处的随机位置</span></span><br><span class="line">SpawnEdge edge = (SpawnEdge)(<span class="built_in">rand</span>() % <span class="number">4</span>);</span><br><span class="line"><span class="keyword">switch</span> (edge)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> SpawnEdge::Up:</span><br><span class="line">	position.x = <span class="built_in">rand</span>() % WINDOW_WIDTH;</span><br><span class="line">	position.y = -FRAME_HEIGHT;</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> SpawnEdge::Down:</span><br><span class="line">	position.x = <span class="built_in">rand</span>() % WINDOW_WIDTH;</span><br><span class="line">	position.y = WINDOW_HEIGHT;</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> SpawnEdge::Left:</span><br><span class="line">	position.x = -FRAME_WIDTH;</span><br><span class="line">	position.y = <span class="built_in">rand</span>() % WINDOW_HEIGHT;</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> SpawnEdge::Right:</span><br><span class="line">	position.x = WINDOW_WIDTH;</span><br><span class="line">	position.y = <span class="built_in">rand</span>() % WINDOW_HEIGHT;</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自动寻路"><a href="#自动寻路" class="headerlink" title="自动寻路"></a>自动寻路</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">(<span class="type">const</span> Player&amp; player)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">const</span> POINT&amp; player_position = player.<span class="built_in">GetPosition</span>();</span><br><span class="line">	<span class="type">int</span> dir_x = player_position.x - position.x; </span><br><span class="line">	<span class="type">int</span> dir_y = player_position.y - position.y;</span><br><span class="line">	<span class="type">double</span> len_dir = <span class="built_in">sqrt</span>(dir_x * dir_x + dir_y * dir_y); </span><br><span class="line">	<span class="keyword">if</span> (len_dir != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">double</span> normalized_x = dir_x / len_dir;</span><br><span class="line">		<span class="type">double</span> normalized_y = dir_y / len_dir;</span><br><span class="line">		position.x += (<span class="type">int</span>)(SPEED * normalized_x);</span><br><span class="line">		position.y += (<span class="type">int</span>)(SPEED * normalized_y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (dir_x &lt; <span class="number">0</span>)</span><br><span class="line">		facing_left = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (dir_x &gt; <span class="number">0</span>)</span><br><span class="line">		facing_left = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="算法特点"><a href="#算法特点" class="headerlink" title="算法特点"></a>算法特点</h4><p>-每帧重新计算方向，实现实时追踪。<br>-使用浮点数来进行计算保证了移动的平滑</p>
<hr>
<h2 id="四、碰撞检测系统"><a href="#四、碰撞检测系统" class="headerlink" title="四、碰撞检测系统"></a>四、碰撞检测系统</h2><h3 id="4-1-设计思路"><a href="#4-1-设计思路" class="headerlink" title="4.1 设计思路"></a>4.1 设计思路</h3><p><strong>目标</strong>：实现精确的碰撞判定</p>
<p><strong>关键问题</strong>：</p>
<ul>
<li>如何高效检测不同形状的碰撞？</li>
<li>如何处理不同物体的碰撞关系？</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>玩家与敌人：点-矩形碰撞</li>
<li>子弹与敌人：点-矩形碰撞</li>
</ul>
<h3 id="4-2-代码实现"><a href="#4-2-代码实现" class="headerlink" title="4.2 代码实现"></a>4.2 代码实现</h3><h4 id="子弹与敌人碰撞"><a href="#子弹与敌人碰撞" class="headerlink" title="子弹与敌人碰撞"></a>子弹与敌人碰撞</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CheckBulletCollision</span><span class="params">(<span class="type">const</span> Bullet&amp; bullet)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 将子弹等效为点，判断点是否在敌人矩形内</span></span><br><span class="line">	<span class="type">bool</span> is_overlap_x = bullet.position.x &gt;= position.x &amp;&amp; bullet.position.x &lt;= position.x + FRAME_WIDTH;</span><br><span class="line">	<span class="type">bool</span> is_overlap_y = bullet.position.y &gt;= position.y &amp;&amp; bullet.position.y &lt;= position.y + FRAME_HEIGHT;</span><br><span class="line">	<span class="keyword">return</span> is_overlap_x &amp;&amp; is_overlap_y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="玩家与敌人碰撞"><a href="#玩家与敌人碰撞" class="headerlink" title="玩家与敌人碰撞"></a>玩家与敌人碰撞</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">CheckPlayerCollision</span><span class="params">(<span class="type">const</span> Player&amp; player)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 将敌人中心位置等效为点，判断点是否在玩家矩形内</span></span><br><span class="line">	POINT check_position = &#123; position.x + FRAME_WIDTH / <span class="number">2</span>, position.y + FRAME_HEIGHT / <span class="number">2</span> &#125;;</span><br><span class="line">	POINT player_position = player.<span class="built_in">GetPosition</span>();</span><br><span class="line">	<span class="type">bool</span> is_overlap_x = check_position.x &gt;= player_position.x &amp;&amp; check_position.x &lt;= player_position.x + player.FRAME_WIDTH;</span><br><span class="line">	<span class="type">bool</span> is_overlap_y = check_position.y &gt;= player_position.y &amp;&amp; check_position.y &lt;= player_position.y + player.FRAME_HEIGHT;</span><br><span class="line">	<span class="keyword">return</span> is_overlap_x &amp;&amp; is_overlap_y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五、UI系统设计"><a href="#五、UI系统设计" class="headerlink" title="五、UI系统设计"></a>五、UI系统设计</h2><h3 id="5-1-设计思路"><a href="#5-1-设计思路" class="headerlink" title="5.1 设计思路"></a>5.1 设计思路</h3><p><strong>目标</strong>：实现交互式按钮</p>
<p><strong>关键问题</strong>：</p>
<ul>
<li>如何检测鼠标悬停和点击？</li>
<li>如何显示不同按钮状态？</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>使用矩形区域检测鼠标位置</li>
<li>维护按钮状态机（普通&#x2F;悬停&#x2F;按下）</li>
</ul>
<hr>
<h3 id="5-2-代码实现"><a href="#5-2-代码实现" class="headerlink" title="5.2 代码实现"></a>5.2 代码实现</h3><h4 id="按钮基类"><a href="#按钮基类" class="headerlink" title="按钮基类"></a>按钮基类</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Button</span>(RECT rect, LPCTSTR path_img_idle, LPCTSTR path_img_hovered, LPCTSTR path_img_pushed)</span><br><span class="line">	&#123;</span><br><span class="line">		region = rect;</span><br><span class="line">		<span class="built_in">loadimage</span>(&amp;img_idle, path_img_idle);</span><br><span class="line">		<span class="built_in">loadimage</span>(&amp;img_hovered, path_img_hovered);</span><br><span class="line">		<span class="built_in">loadimage</span>(&amp;img_pushed, path_img_pushed);</span><br><span class="line">	&#125;</span><br><span class="line">	~<span class="built_in">Button</span>() = <span class="keyword">default</span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ProcessEvent</span><span class="params">(<span class="type">const</span> ExMessage&amp; msg)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (msg.message)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> WM_MOUSEMOVE:</span><br><span class="line">			<span class="keyword">if</span> (status == Status::Idle &amp;&amp; <span class="built_in">CheckCursorHit</span>(msg.x, msg.y))</span><br><span class="line">				status = Status::Hovered;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (status == Status::Hovered &amp;&amp; !<span class="built_in">CheckCursorHit</span>(msg.x, msg.y))</span><br><span class="line">				status = Status::Idle;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> WM_LBUTTONDOWN:</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">CheckCursorHit</span>(msg.x, msg.y))</span><br><span class="line">				status = Status::Pushed;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> WM_LBUTTONUP:</span><br><span class="line">			<span class="keyword">if</span> (status == Status::Pushed)</span><br><span class="line">				<span class="built_in">OnClick</span>();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Draw</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (status)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> Status::Idle:</span><br><span class="line">			<span class="built_in">putimage</span>(region.left, region.top, &amp;img_idle);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Status::Hovered:</span><br><span class="line">			<span class="built_in">putimage</span>(region.left,region.top, &amp;img_hovered);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Status::Pushed:</span><br><span class="line">			<span class="built_in">putimage</span>(region.left,region.top, &amp;img_pushed);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnClick</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">enum class</span> <span class="title class_">Status</span></span><br><span class="line">	&#123;</span><br><span class="line">		Idle = <span class="number">0</span>,</span><br><span class="line">	    Hovered,</span><br><span class="line">		Pushed</span><br><span class="line">	&#125;;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	RECT region;</span><br><span class="line">	IMAGE img_idle;</span><br><span class="line">	IMAGE img_hovered;</span><br><span class="line">	IMAGE img_pushed;</span><br><span class="line">	Status status = Status::Idle;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">CheckCursorHit</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (x &gt;= region.left &amp;&amp; x &lt;= region.right &amp;&amp; y &gt;= region.top &amp;&amp; y &lt;= region.bottom)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="开始游戏按钮"><a href="#开始游戏按钮" class="headerlink" title="开始游戏按钮"></a>开始游戏按钮</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StartGameButton</span> : <span class="keyword">public</span> Button</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">StartGameButton</span>(RECT rect, LPCTSTR path_img_idle, LPCTSTR path_img_hovered,LPCTSTR path_img_pushed)</span><br><span class="line">: <span class="built_in">Button</span>(rect, path_img_idle, path_img_hovered, path_img_pushed) &#123;&#125;</span><br><span class="line">~<span class="built_in">StartGameButton</span>() = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">OnClick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		is_game_started = <span class="literal">true</span>;</span><br><span class="line">		<span class="built_in">mciSendString</span>(_T(<span class="string">&quot;play bgm repeat from 0&quot;</span>), <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="结束游戏按钮"><a href="#结束游戏按钮" class="headerlink" title="结束游戏按钮"></a>结束游戏按钮</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">QuitGameButton</span> : <span class="keyword">public</span> Button</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">QuitGameButton</span>(RECT rect, LPCTSTR path_img_idle, LPCTSTR path_img_hovered, LPCTSTR path_img_pushed)</span><br><span class="line">		: <span class="built_in">Button</span>(rect, path_img_idle, path_img_hovered, path_img_pushed) &#123;&#125;</span><br><span class="line">	~<span class="built_in">QuitGameButton</span>() = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">OnClick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		running = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="六、游戏循环架构"><a href="#六、游戏循环架构" class="headerlink" title="六、游戏循环架构"></a>六、游戏循环架构</h2><h3 id="6-1-主循环结构"><a href="#6-1-主循环结构" class="headerlink" title="6.1 主循环结构"></a>6.1 主循环结构</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (running)</span><br><span class="line">&#123;</span><br><span class="line">	DWORD start_time = <span class="built_in">GetTickCount</span>();</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">peekmessage</span>(&amp;msg))<span class="comment">//获取输入</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(is_game_started)</span><br><span class="line">		player.<span class="built_in">ProcessEvent</span>(msg);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			btn_start_game.<span class="built_in">ProcessEvent</span>(msg);</span><br><span class="line">			btn_quit_game.<span class="built_in">ProcessEvent</span>(msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (is_game_started)</span><br><span class="line">	&#123;</span><br><span class="line">		player.<span class="built_in">Move</span>();</span><br><span class="line">		<span class="built_in">UpdateBullets</span>(bullet_list, player);</span><br><span class="line">		<span class="built_in">TryGenerateEnemy</span>(enemy_list);</span><br><span class="line">		<span class="keyword">for</span> (Enemy* enemy : enemy_list)</span><br><span class="line">			enemy-&gt;<span class="built_in">Move</span>(player);</span><br><span class="line">		<span class="comment">// 检测敌人和玩家的碰撞</span></span><br><span class="line">		<span class="keyword">for</span> (Enemy* enemy : enemy_list)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (enemy-&gt;<span class="built_in">CheckPlayerCollision</span>(player))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="type">static</span> TCHAR text[<span class="number">128</span>];</span><br><span class="line">				_stprintf_s(text, _T(<span class="string">&quot;最终得分：%d !&quot;</span>), score);</span><br><span class="line">				<span class="built_in">MessageBox</span>(<span class="built_in">GetHWnd</span>(), text, _T(<span class="string">&quot;游戏结束&quot;</span>), MB_OK);</span><br><span class="line">				running = <span class="literal">false</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//检测子弹和敌人的碰撞</span></span><br><span class="line">		<span class="keyword">for</span> (Enemy* enemy : enemy_list)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">const</span> Bullet&amp; bullet : bullet_list)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (enemy-&gt;<span class="built_in">CheckBulletCollision</span>(bullet))</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">mciSendString</span>(_T(<span class="string">&quot;play hit from 0&quot;</span>), <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">					enemy-&gt;<span class="built_in">Hurt</span>();</span><br><span class="line">					score++;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//移除生命值归零的敌人</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; enemy_list.<span class="built_in">size</span>(); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			Enemy* enemy = enemy_list[i];</span><br><span class="line">			<span class="keyword">if</span> (!enemy-&gt;<span class="built_in">CheckAlive</span>())</span><br><span class="line">			&#123;</span><br><span class="line">				std::<span class="built_in">swap</span>(enemy_list[i], enemy_list.<span class="built_in">back</span>());</span><br><span class="line">				enemy_list.<span class="built_in">pop_back</span>();</span><br><span class="line">				<span class="keyword">delete</span> enemy;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">cleardevice</span>();<span class="comment">//进行渲染</span></span><br><span class="line">	<span class="keyword">if</span> (is_game_started)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">putimage</span>(<span class="number">0</span>, <span class="number">0</span>, &amp;img_background);</span><br><span class="line">		player.<span class="built_in">Draw</span>(<span class="number">1000</span> / <span class="number">144</span>);</span><br><span class="line">		<span class="keyword">for</span> (Enemy* enemy : enemy_list)</span><br><span class="line">			enemy-&gt;<span class="built_in">Draw</span>(<span class="number">1000</span> / <span class="number">144</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">const</span> Bullet&amp; bullet : bullet_list)</span><br><span class="line">			bullet.<span class="built_in">Draw</span>();</span><br><span class="line">		<span class="comment">//DrawPlayer(1000 / 144, is_move_right - is_move_left);</span></span><br><span class="line">		<span class="built_in">DrawPlayerScore</span>(score);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">putimage</span>(<span class="number">0</span>, <span class="number">0</span>, &amp;img_menu);</span><br><span class="line">		btn_start_game.<span class="built_in">Draw</span>();</span><br><span class="line">		btn_quit_game.<span class="built_in">Draw</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">FlushBatchDraw</span>();</span><br><span class="line">	DWORD end_time = <span class="built_in">GetTickCount</span>();</span><br><span class="line">	DWORD delta_time = end_time - start_time;</span><br><span class="line">	<span class="keyword">if</span> (delta_time &lt; <span class="number">1000</span> / <span class="number">144</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">Sleep</span>(<span class="number">1000</span> / <span class="number">144</span> - delta_time);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="七、源代码展示"><a href="#七、源代码展示" class="headerlink" title="七、源代码展示"></a>七、源代码展示</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;easyx.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="type">int</span> idx_current_anim = <span class="number">0</span>;<span class="comment">//当前帧索引</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> PLAYER_ANIN_NUM = <span class="number">6</span>;<span class="comment">//玩家动画总帧数</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> PLAYER_SPEED = <span class="number">3</span>;<span class="comment">//玩家移动速度</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> PLAYER_WIDTH = <span class="number">80</span>;<span class="comment">//玩家宽度</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> PLAYER_HEIGHT = <span class="number">80</span>;<span class="comment">//玩家高度</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> SHADOW_WIDTH = <span class="number">32</span>;<span class="comment">//阴影宽度</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> WINDOW_WIDTH = <span class="number">1280</span>;<span class="comment">//游戏窗口宽度</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> WINDOW_HEIGHT = <span class="number">720</span>;<span class="comment">//游戏窗口宽度</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> BUTTON_WIDTH = <span class="number">192</span>;<span class="comment">//按钮宽度</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> BUTTON_HEIGHT = <span class="number">75</span>;<span class="comment">//按钮高度</span></span><br><span class="line">IMAGE img_player_left[PLAYER_ANIN_NUM];<span class="comment">//加载玩家向左移动动画资源</span></span><br><span class="line">IMAGE img_player_right[PLAYER_ANIN_NUM];<span class="comment">//加载玩家向右移动动画资源</span></span><br><span class="line">POINT player_pos = &#123; <span class="number">500</span>,<span class="number">500</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;MSIMG32.LIB&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;Winmm.lib&quot;</span>)</span></span><br><span class="line"><span class="type">bool</span> is_game_started = <span class="literal">false</span>;     <span class="comment">//判断游戏是否开始</span></span><br><span class="line"><span class="type">bool</span> running = <span class="literal">true</span>;              <span class="comment">//判断玩家是否奔跑</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">putimage_alpha</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, IMAGE* img)</span><span class="comment">//绘制透明图像</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> w = img-&gt;<span class="built_in">getwidth</span>();</span><br><span class="line">	<span class="type">int</span> h = img-&gt;<span class="built_in">getheight</span>();</span><br><span class="line">	<span class="built_in">AlphaBlend</span>(<span class="built_in">GetImageHDC</span>(<span class="literal">NULL</span>), x, y, w, h,</span><br><span class="line">		<span class="built_in">GetImageHDC</span>(img), <span class="number">0</span>, <span class="number">0</span>, w, h, &#123; AC_SRC_OVER,<span class="number">0</span>,<span class="number">225</span>,AC_SRC_ALPHA &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Atlas</span><span class="comment">//动画资源类</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Atlas</span>(LPCTSTR path, <span class="type">int</span> num)</span><br><span class="line">	&#123;</span><br><span class="line">		TCHAR path_file[<span class="number">256</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			_stprintf_s(path_file, path, i);</span><br><span class="line">			IMAGE* frame = <span class="keyword">new</span> <span class="built_in">IMAGE</span>();</span><br><span class="line">			<span class="built_in">loadimage</span>(frame, path_file);</span><br><span class="line">			frame_list.<span class="built_in">push_back</span>(frame);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	~<span class="built_in">Atlas</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; frame_list.<span class="built_in">size</span>(); i++)</span><br><span class="line">			<span class="keyword">delete</span> frame_list[i];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	std::vector&lt;IMAGE*&gt; frame_list;</span><br><span class="line">&#125;;</span><br><span class="line">Atlas* atlas_player_left;</span><br><span class="line">Atlas* atlas_player_right;</span><br><span class="line">Atlas* atlas_enemy_left;</span><br><span class="line">Atlas* atlas_enemy_right;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animation</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Animation</span>(Atlas* atlas, <span class="type">int</span> interval)</span><br><span class="line">	&#123;</span><br><span class="line">		anim_atlas = atlas;</span><br><span class="line">		interval_ms = interval;</span><br><span class="line">	&#125;</span><br><span class="line">	~<span class="built_in">Animation</span>() = <span class="keyword">default</span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Play</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> delta)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		timer += delta;</span><br><span class="line">		<span class="keyword">if</span> (timer &gt;= interval_ms)</span><br><span class="line">		&#123;</span><br><span class="line">			idx_frame = (idx_frame + <span class="number">1</span>) % anim_atlas-&gt; frame_list.<span class="built_in">size</span>();</span><br><span class="line">			timer = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">putimage_alpha</span>(x, y, anim_atlas-&gt;frame_list[idx_frame]);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">int</span> timer = <span class="number">0</span>;<span class="comment">//动画计时器</span></span><br><span class="line">	<span class="type">int</span> idx_frame = <span class="number">0</span>;<span class="comment">//动画帧索引</span></span><br><span class="line">	<span class="type">int</span> interval_ms = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Atlas* anim_atlas;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Player</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> FRAME_WIDTH = <span class="number">80</span>;	<span class="comment">//玩家宽度	</span></span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> FRAME_HEIGHT = <span class="number">80</span>;	<span class="comment">// 玩家高度	</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Player</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">loadimage</span>(&amp;img_shadow, _T(<span class="string">&quot;img/shadow_player.png&quot;</span>));</span><br><span class="line">		anim_left = <span class="keyword">new</span> <span class="built_in">Animation</span>(atlas_player_left, <span class="number">45</span>);</span><br><span class="line">		anim_right = <span class="keyword">new</span> <span class="built_in">Animation</span>(atlas_player_right, <span class="number">45</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	~<span class="built_in">Player</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">delete</span> anim_left;</span><br><span class="line">		<span class="keyword">delete</span> anim_right;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ProcessEvent</span><span class="params">(<span class="type">const</span> ExMessage&amp; msg)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (msg.message == WM_KEYDOWN)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">switch</span> (msg.vkcode)</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="keyword">case</span><span class="string">&#x27;W&#x27;</span>:</span><br><span class="line">			<span class="keyword">case</span> VK_UP:</span><br><span class="line">				is_move_up = <span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span><span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">			<span class="keyword">case</span> VK_DOWN:</span><br><span class="line">				is_move_down = <span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span><span class="string">&#x27;A&#x27;</span>:</span><br><span class="line">			<span class="keyword">case</span> VK_LEFT:</span><br><span class="line">				is_move_left = <span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span><span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">			<span class="keyword">case</span> VK_RIGHT:</span><br><span class="line">				is_move_right = <span class="literal">true</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (msg.message == WM_KEYUP)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">switch</span> (msg.vkcode)</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="keyword">case</span><span class="string">&#x27;W&#x27;</span>:</span><br><span class="line">			<span class="keyword">case</span> VK_UP:</span><br><span class="line">				is_move_up = <span class="literal">false</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span><span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">			<span class="keyword">case</span> VK_DOWN:</span><br><span class="line">				is_move_down = <span class="literal">false</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span><span class="string">&#x27;A&#x27;</span>:</span><br><span class="line">			<span class="keyword">case</span> VK_LEFT:</span><br><span class="line">				is_move_left = <span class="literal">false</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span><span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">			<span class="keyword">case</span> VK_RIGHT:</span><br><span class="line">				is_move_right = <span class="literal">false</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> dir_x = is_move_right - is_move_left; </span><br><span class="line">		<span class="type">int</span> dir_y = is_move_down - is_move_up;</span><br><span class="line">		<span class="type">double</span> len_dir = <span class="built_in">sqrt</span>(dir_x * dir_x + dir_y * dir_y);</span><br><span class="line">		<span class="keyword">if</span> (len_dir != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">double</span> normalized_x = dir_x / len_dir;</span><br><span class="line">			<span class="type">double</span> normalized_y = dir_y / len_dir;</span><br><span class="line">			position.x += (<span class="type">int</span>)(SPEED * normalized_x);</span><br><span class="line">			position.y += (<span class="type">int</span>)(SPEED * normalized_y);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (position.x &lt; <span class="number">0</span>) position.x = <span class="number">0</span>; </span><br><span class="line">		<span class="keyword">if</span> (position.y &lt; <span class="number">0</span>) position.y = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> (position.x + FRAME_WIDTH &gt; WINDOW_WIDTH) position.x = WINDOW_WIDTH - FRAME_WIDTH; </span><br><span class="line">		<span class="keyword">if</span> (position.y + FRAME_HEIGHT &gt; WINDOW_HEIGHT) position.y = WINDOW_HEIGHT - FRAME_HEIGHT;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Draw</span><span class="params">(<span class="type">int</span> delta)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> pos_shadow_x = position.x + (FRAME_WIDTH / <span class="number">2</span> - SHADOW_WIDTH / <span class="number">2</span>); </span><br><span class="line">		<span class="type">int</span> pos_shadow_y = position.y + FRAME_HEIGHT - <span class="number">8</span>;</span><br><span class="line">		<span class="built_in">putimage_alpha</span>(pos_shadow_x, pos_shadow_y, &amp;img_shadow);</span><br><span class="line">		<span class="type">static</span> <span class="type">bool</span> facing_left = <span class="literal">false</span>;</span><br><span class="line">		<span class="type">int</span> dir_x = is_move_right - is_move_left;</span><br><span class="line">		<span class="keyword">if</span> (dir_x &lt; <span class="number">0</span>)</span><br><span class="line">			facing_left = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (dir_x &gt; <span class="number">0</span>)</span><br><span class="line">			facing_left = <span class="literal">false</span>; </span><br><span class="line">		<span class="keyword">if</span> (facing_left)</span><br><span class="line">			anim_left-&gt;<span class="built_in">Play</span>(position.x, position.y, delta);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			anim_right-&gt;<span class="built_in">Play</span>(position.x, position.y, delta);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">const</span> POINT&amp; <span class="title">GetPosition</span><span class="params">()</span><span class="type">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> position;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> SPEED = <span class="number">3</span>;	</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> SHADOW_WIDTH = <span class="number">32</span>;	<span class="comment">//阴影宽度	</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	IMAGE img_shadow;</span><br><span class="line">	Animation* anim_left;</span><br><span class="line">	Animation* anim_right;</span><br><span class="line">	POINT position = &#123; <span class="number">500</span>,<span class="number">500</span> &#125;;</span><br><span class="line">	<span class="type">bool</span> is_move_up = <span class="literal">false</span>;</span><br><span class="line">	<span class="type">bool</span> is_move_down = <span class="literal">false</span>;</span><br><span class="line">	<span class="type">bool</span> is_move_left = <span class="literal">false</span>;</span><br><span class="line">	<span class="type">bool</span> is_move_right = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bullet</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	POINT position = &#123; <span class="number">0</span>,<span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Bullet</span>() = <span class="keyword">default</span>;</span><br><span class="line">	~<span class="built_in">Bullet</span>() = <span class="keyword">default</span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Draw</span><span class="params">()</span><span class="type">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">setlinecolor</span>(<span class="built_in">RGB</span>(<span class="number">255</span>, <span class="number">155</span>, <span class="number">50</span>));</span><br><span class="line">		<span class="built_in">setfillcolor</span>(<span class="built_in">RGB</span>(<span class="number">200</span>, <span class="number">75</span>, <span class="number">10</span>));</span><br><span class="line">		<span class="built_in">fillcircle</span>(position.x, position.y, RADIUS);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> RADIUS = <span class="number">10</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Enemy</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Enemy</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">loadimage</span>(&amp;img_shadow, _T(<span class="string">&quot;img/shadow_enemy.png&quot;</span>));</span><br><span class="line">		anim_left = <span class="keyword">new</span> <span class="built_in">Animation</span>(atlas_enemy_left, <span class="number">45</span>);</span><br><span class="line">		anim_right = <span class="keyword">new</span> <span class="built_in">Animation</span>(atlas_enemy_right, <span class="number">45</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 敌人生成边界</span></span><br><span class="line">		<span class="keyword">enum class</span> <span class="title class_">SpawnEdge</span> </span><br><span class="line">		&#123;</span><br><span class="line">			Up = <span class="number">0</span>, </span><br><span class="line">			Down, </span><br><span class="line">			Left,</span><br><span class="line">			Right</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="comment">// 将敌人放置在地图外边界处的随机位置</span></span><br><span class="line">		SpawnEdge edge = (SpawnEdge)(<span class="built_in">rand</span>() % <span class="number">4</span>);</span><br><span class="line">		<span class="keyword">switch</span> (edge)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> SpawnEdge::Up:</span><br><span class="line">			position.x = <span class="built_in">rand</span>() % WINDOW_WIDTH;</span><br><span class="line">			position.y = -FRAME_HEIGHT;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> SpawnEdge::Down:</span><br><span class="line">			position.x = <span class="built_in">rand</span>() % WINDOW_WIDTH;</span><br><span class="line">			position.y = WINDOW_HEIGHT;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> SpawnEdge::Left:</span><br><span class="line">			position.x = -FRAME_WIDTH;</span><br><span class="line">			position.y = <span class="built_in">rand</span>() % WINDOW_HEIGHT;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> SpawnEdge::Right:</span><br><span class="line">			position.x = WINDOW_WIDTH;</span><br><span class="line">			position.y = <span class="built_in">rand</span>() % WINDOW_HEIGHT;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">CheckBulletCollision</span><span class="params">(<span class="type">const</span> Bullet&amp; bullet)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 将子弹等效为点，判断点是否在敌人矩形内</span></span><br><span class="line">		<span class="type">bool</span> is_overlap_x = bullet.position.x &gt;= position.x &amp;&amp; bullet.position.x &lt;= position.x + FRAME_WIDTH;</span><br><span class="line">		<span class="type">bool</span> is_overlap_y = bullet.position.y &gt;= position.y &amp;&amp; bullet.position.y &lt;= position.y + FRAME_HEIGHT;</span><br><span class="line">		<span class="keyword">return</span> is_overlap_x &amp;&amp; is_overlap_y;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">CheckPlayerCollision</span><span class="params">(<span class="type">const</span> Player&amp; player)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 将敌人中心位置等效为点，判断点是否在玩家矩形内</span></span><br><span class="line">		POINT check_position = &#123; position.x + FRAME_WIDTH / <span class="number">2</span>, position.y + FRAME_HEIGHT / <span class="number">2</span> &#125;;</span><br><span class="line">		POINT player_position = player.<span class="built_in">GetPosition</span>();</span><br><span class="line">		<span class="type">bool</span> is_overlap_x = check_position.x &gt;= player_position.x &amp;&amp; check_position.x &lt;= player_position.x + player.FRAME_WIDTH;</span><br><span class="line">		<span class="type">bool</span> is_overlap_y = check_position.y &gt;= player_position.y &amp;&amp; check_position.y &lt;= player_position.y + player.FRAME_HEIGHT;</span><br><span class="line">		<span class="keyword">return</span> is_overlap_x &amp;&amp; is_overlap_y;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">(<span class="type">const</span> Player&amp; player)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">const</span> POINT&amp; player_position = player.<span class="built_in">GetPosition</span>();</span><br><span class="line">		<span class="type">int</span> dir_x = player_position.x - position.x; </span><br><span class="line">		<span class="type">int</span> dir_y = player_position.y - position.y;</span><br><span class="line">		<span class="type">double</span> len_dir = <span class="built_in">sqrt</span>(dir_x * dir_x + dir_y * dir_y); </span><br><span class="line">		<span class="keyword">if</span> (len_dir != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">double</span> normalized_x = dir_x / len_dir;</span><br><span class="line">			<span class="type">double</span> normalized_y = dir_y / len_dir;</span><br><span class="line">			position.x += (<span class="type">int</span>)(SPEED * normalized_x);</span><br><span class="line">			position.y += (<span class="type">int</span>)(SPEED * normalized_y);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (dir_x &lt; <span class="number">0</span>)</span><br><span class="line">			facing_left = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (dir_x &gt; <span class="number">0</span>)</span><br><span class="line">			facing_left = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Draw</span><span class="params">(<span class="type">int</span> delta)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="type">int</span> pos_shadow_x = position.x + (FRAME_WIDTH / <span class="number">2</span> - SHADOW_WIDTH / <span class="number">2</span>);</span><br><span class="line">		<span class="type">int</span> pos_shadow_y = position.y + FRAME_HEIGHT - <span class="number">35</span>;</span><br><span class="line">		<span class="built_in">putimage_alpha</span>(pos_shadow_x, pos_shadow_y, &amp;img_shadow);</span><br><span class="line">		<span class="keyword">if</span> (facing_left)</span><br><span class="line">			anim_left-&gt;<span class="built_in">Play</span>(position.x, position.y, delta);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			anim_right-&gt;<span class="built_in">Play</span>(position.x, position.y, delta);</span><br><span class="line">	&#125;</span><br><span class="line">	~<span class="built_in">Enemy</span>()</span><br><span class="line">	&#123;</span><br><span class="line">			<span class="keyword">delete</span> anim_left; </span><br><span class="line">			<span class="keyword">delete</span> anim_right;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Hurt</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		alive = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">CheckAlive</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> alive;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> SPEED = <span class="number">2</span>;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> FRAME_WIDTH = <span class="number">80</span>;	<span class="comment">//敌人宽度	</span></span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> FRAME_HEIGHT = <span class="number">80</span>;	<span class="comment">//敌人高度	</span></span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> SHADOW_WIDTH = <span class="number">48</span>;	<span class="comment">// 阴影宽度	</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	IMAGE img_shadow;</span><br><span class="line">	Animation* anim_left;</span><br><span class="line">	Animation* anim_right;</span><br><span class="line">	POINT position = &#123; <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="type">bool</span> facing_left = <span class="literal">false</span>;</span><br><span class="line">	<span class="type">bool</span> alive = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Button</span>(RECT rect, LPCTSTR path_img_idle, LPCTSTR path_img_hovered, LPCTSTR path_img_pushed)</span><br><span class="line">	&#123;</span><br><span class="line">		region = rect;</span><br><span class="line">		<span class="built_in">loadimage</span>(&amp;img_idle, path_img_idle);</span><br><span class="line">		<span class="built_in">loadimage</span>(&amp;img_hovered, path_img_hovered);</span><br><span class="line">		<span class="built_in">loadimage</span>(&amp;img_pushed, path_img_pushed);</span><br><span class="line">	&#125;</span><br><span class="line">	~<span class="built_in">Button</span>() = <span class="keyword">default</span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ProcessEvent</span><span class="params">(<span class="type">const</span> ExMessage&amp; msg)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (msg.message)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> WM_MOUSEMOVE:</span><br><span class="line">			<span class="keyword">if</span> (status == Status::Idle &amp;&amp; <span class="built_in">CheckCursorHit</span>(msg.x, msg.y))</span><br><span class="line">				status = Status::Hovered;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (status == Status::Hovered &amp;&amp; !<span class="built_in">CheckCursorHit</span>(msg.x, msg.y))</span><br><span class="line">				status = Status::Idle;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> WM_LBUTTONDOWN:</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">CheckCursorHit</span>(msg.x, msg.y))</span><br><span class="line">				status = Status::Pushed;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> WM_LBUTTONUP:</span><br><span class="line">			<span class="keyword">if</span> (status == Status::Pushed)</span><br><span class="line">				<span class="built_in">OnClick</span>();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Draw</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (status)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> Status::Idle:</span><br><span class="line">			<span class="built_in">putimage</span>(region.left, region.top, &amp;img_idle);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Status::Hovered:</span><br><span class="line">			<span class="built_in">putimage</span>(region.left,region.top, &amp;img_hovered);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> Status::Pushed:</span><br><span class="line">			<span class="built_in">putimage</span>(region.left,region.top, &amp;img_pushed);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OnClick</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">enum class</span> <span class="title class_">Status</span></span><br><span class="line">	&#123;</span><br><span class="line">		Idle = <span class="number">0</span>,</span><br><span class="line">	    Hovered,</span><br><span class="line">		Pushed</span><br><span class="line">	&#125;;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	RECT region;</span><br><span class="line">	IMAGE img_idle;</span><br><span class="line">	IMAGE img_hovered;</span><br><span class="line">	IMAGE img_pushed;</span><br><span class="line">	Status status = Status::Idle;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">CheckCursorHit</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (x &gt;= region.left &amp;&amp; x &lt;= region.right &amp;&amp; y &gt;= region.top &amp;&amp; y &lt;= region.bottom)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始游戏按钮</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StartGameButton</span> : <span class="keyword">public</span> Button</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">StartGameButton</span>(RECT rect, LPCTSTR path_img_idle, LPCTSTR path_img_hovered,LPCTSTR path_img_pushed)</span><br><span class="line">: <span class="built_in">Button</span>(rect, path_img_idle, path_img_hovered, path_img_pushed) &#123;&#125;</span><br><span class="line">~<span class="built_in">StartGameButton</span>() = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">OnClick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		is_game_started = <span class="literal">true</span>;</span><br><span class="line">		<span class="built_in">mciSendString</span>(_T(<span class="string">&quot;play bgm repeat from 0&quot;</span>), <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 退出游戏按钮</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QuitGameButton</span> : <span class="keyword">public</span> Button</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">QuitGameButton</span>(RECT rect, LPCTSTR path_img_idle, LPCTSTR path_img_hovered, LPCTSTR path_img_pushed)</span><br><span class="line">		: <span class="built_in">Button</span>(rect, path_img_idle, path_img_hovered, path_img_pushed) &#123;&#125;</span><br><span class="line">	~<span class="built_in">QuitGameButton</span>() = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">OnClick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		running = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">IMAGE img_shadow;</span><br><span class="line"><span class="comment">// 生成新的敌人</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TryGenerateEnemy</span><span class="params">(std::vector&lt;Enemy*&gt;&amp; enemy_list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> INTERVAL = <span class="number">100</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> counter = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> ((++counter) % INTERVAL == <span class="number">0</span>)</span><br><span class="line">		enemy_list.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">Enemy</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新子弹位置</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UpdateBullets</span><span class="params">(std::vector&lt;Bullet&gt;&amp; bullet_list, <span class="type">const</span> Player&amp; player)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">double</span> RADIAL_SPEED = <span class="number">0.0045</span>;	<span class="comment">//径向波动速度	</span></span><br><span class="line">	<span class="type">const</span> <span class="type">double</span> TANGENT_SPEED = <span class="number">0.0055</span>;	<span class="comment">// 切向波动速度	</span></span><br><span class="line">	<span class="type">double</span> radian_interval = <span class="number">2</span> * <span class="number">3.14159</span> / bullet_list.<span class="built_in">size</span>(); <span class="comment">// 子弹之间的弧度间隔</span></span><br><span class="line">	POINT player_position = player.<span class="built_in">GetPosition</span>();</span><br><span class="line">	<span class="type">double</span> radius = <span class="number">100</span> + <span class="number">25</span> * <span class="built_in">sin</span>(<span class="built_in">GetTickCount</span>() * RADIAL_SPEED);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; bullet_list.<span class="built_in">size</span>(); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">double</span> radian = <span class="built_in">GetTickCount</span>() * TANGENT_SPEED + radian_interval * i; <span class="comment">// 当前子弹所在弧度值</span></span><br><span class="line">		bullet_list[i].position.x = player_position.x + player.FRAME_WIDTH / <span class="number">2</span> + (<span class="type">int</span>)(radius * <span class="built_in">sin</span>(radian));</span><br><span class="line">		bullet_list[i].position.y = player_position.y + player.FRAME_HEIGHT / <span class="number">2</span> + (<span class="type">int</span>)(radius * <span class="built_in">cos</span>(radian));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 绘制玩家得分</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DrawPlayerScore</span><span class="params">(<span class="type">int</span> score)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">static</span> TCHAR text[<span class="number">64</span>];</span><br><span class="line">	_stprintf_s(text, _T(<span class="string">&quot;当前玩家得分:%d&quot;</span>), score);</span><br><span class="line">	<span class="built_in">setbkmode</span>(TRANSPARENT);</span><br><span class="line">	<span class="built_in">settextcolor</span>(<span class="built_in">RGB</span>(<span class="number">255</span>, <span class="number">85</span>, <span class="number">185</span>));</span><br><span class="line">	<span class="built_in">outtextxy</span>(<span class="number">10</span>, <span class="number">10</span>, text);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">initgraph</span>(<span class="number">1280</span>, <span class="number">720</span>);</span><br><span class="line">	atlas_player_left = <span class="keyword">new</span> <span class="built_in">Atlas</span>(_T(<span class="string">&quot;img/player_left_%d.png&quot;</span>), <span class="number">6</span>); </span><br><span class="line">	atlas_player_right = <span class="keyword">new</span> <span class="built_in">Atlas</span>(_T(<span class="string">&quot;img/player_right_%d.png&quot;</span>), <span class="number">6</span>);</span><br><span class="line">	atlas_enemy_left = <span class="keyword">new</span> <span class="built_in">Atlas</span>(_T(<span class="string">&quot;img/enemy_left_%d.png&quot;</span>), <span class="number">6</span>); </span><br><span class="line">	atlas_enemy_right = <span class="keyword">new</span> <span class="built_in">Atlas</span>(_T(<span class="string">&quot;img/enemy_right_%d.png&quot;</span>), <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">mciSendString</span>(_T(<span class="string">&quot;open mus/bgm.mp3 alias bgm&quot;</span>), <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="built_in">mciSendString</span>(_T(<span class="string">&quot;open mus/hit.wav alias hit&quot;</span>), <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">	<span class="type">int</span> score = <span class="number">0</span>;</span><br><span class="line">	Player player;</span><br><span class="line">	ExMessage msg;</span><br><span class="line">	IMAGE img_menu;</span><br><span class="line">	IMAGE img_background;</span><br><span class="line">	std::vector&lt;Enemy*&gt;enemy_list;</span><br><span class="line">	std::vector&lt;Bullet&gt;<span class="built_in">bullet_list</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">	RECT region_btn_start_game, region_btn_quit_game;</span><br><span class="line">	region_btn_start_game.left = (WINDOW_WIDTH - BUTTON_WIDTH) / <span class="number">2</span>;</span><br><span class="line">	region_btn_start_game.right = region_btn_start_game.left + BUTTON_WIDTH; </span><br><span class="line">	region_btn_start_game.top = <span class="number">430</span>;</span><br><span class="line">	region_btn_start_game.bottom = region_btn_start_game.top + BUTTON_HEIGHT;</span><br><span class="line">	region_btn_quit_game.left = (WINDOW_WIDTH - BUTTON_WIDTH) / <span class="number">2</span>;</span><br><span class="line">	region_btn_quit_game.right = region_btn_quit_game.left + BUTTON_WIDTH; </span><br><span class="line">	region_btn_quit_game.top = <span class="number">550</span>;</span><br><span class="line">	region_btn_quit_game.bottom = region_btn_quit_game.top + BUTTON_HEIGHT;</span><br><span class="line">	StartGameButton btn_start_game = <span class="built_in">StartGameButton</span>(region_btn_start_game,</span><br><span class="line">		_T(<span class="string">&quot;img/ui_start_idle.png&quot;</span>), _T(<span class="string">&quot;img/ui_start_hovered.png&quot;</span>), _T(<span class="string">&quot;img/ui_start_pushed.png&quot;</span>));</span><br><span class="line">	QuitGameButton btn_quit_game = <span class="built_in">QuitGameButton</span>(region_btn_quit_game,</span><br><span class="line">			_T(<span class="string">&quot;img/ui_quit_idle.png&quot;</span>), _T(<span class="string">&quot;img/ui_quit_hovered.png&quot;</span>), _T(<span class="string">&quot;img/ui_quit_pushed.png&quot;</span>));</span><br><span class="line">	<span class="built_in">loadimage</span>(&amp;img_menu, _T(<span class="string">&quot;img/menu.png&quot;</span>));</span><br><span class="line">	<span class="built_in">loadimage</span>(&amp;img_background, _T(<span class="string">&quot;img/background.png&quot;</span>));</span><br><span class="line">	<span class="built_in">BeginBatchDraw</span>();</span><br><span class="line">	<span class="built_in">BeginBatchDraw</span>();</span><br><span class="line">	<span class="keyword">while</span> (running)</span><br><span class="line">	&#123;</span><br><span class="line">		DWORD start_time = <span class="built_in">GetTickCount</span>();</span><br><span class="line">		<span class="keyword">while</span> (<span class="built_in">peekmessage</span>(&amp;msg))<span class="comment">//获取输入</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(is_game_started)</span><br><span class="line">			player.<span class="built_in">ProcessEvent</span>(msg);</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				btn_start_game.<span class="built_in">ProcessEvent</span>(msg);</span><br><span class="line">				btn_quit_game.<span class="built_in">ProcessEvent</span>(msg);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (is_game_started)</span><br><span class="line">		&#123;</span><br><span class="line">			player.<span class="built_in">Move</span>();</span><br><span class="line">			<span class="built_in">UpdateBullets</span>(bullet_list, player);</span><br><span class="line">			<span class="built_in">TryGenerateEnemy</span>(enemy_list);</span><br><span class="line">			<span class="keyword">for</span> (Enemy* enemy : enemy_list)</span><br><span class="line">				enemy-&gt;<span class="built_in">Move</span>(player);</span><br><span class="line">			<span class="comment">// 检测敌人和玩家的碰撞</span></span><br><span class="line">			<span class="keyword">for</span> (Enemy* enemy : enemy_list)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (enemy-&gt;<span class="built_in">CheckPlayerCollision</span>(player))</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="type">static</span> TCHAR text[<span class="number">128</span>];</span><br><span class="line">					_stprintf_s(text, _T(<span class="string">&quot;最终得分：%d !&quot;</span>), score);</span><br><span class="line">					<span class="built_in">MessageBox</span>(<span class="built_in">GetHWnd</span>(), text, _T(<span class="string">&quot;游戏结束&quot;</span>), MB_OK);</span><br><span class="line">					running = <span class="literal">false</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//检测子弹和敌人的碰撞</span></span><br><span class="line">			<span class="keyword">for</span> (Enemy* enemy : enemy_list)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">const</span> Bullet&amp; bullet : bullet_list)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (enemy-&gt;<span class="built_in">CheckBulletCollision</span>(bullet))</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="built_in">mciSendString</span>(_T(<span class="string">&quot;play hit from 0&quot;</span>), <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">						enemy-&gt;<span class="built_in">Hurt</span>();</span><br><span class="line">						score++;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//移除生命值归零的敌人</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; enemy_list.<span class="built_in">size</span>(); i++)</span><br><span class="line">			&#123;</span><br><span class="line">				Enemy* enemy = enemy_list[i];</span><br><span class="line">				<span class="keyword">if</span> (!enemy-&gt;<span class="built_in">CheckAlive</span>())</span><br><span class="line">				&#123;</span><br><span class="line">					std::<span class="built_in">swap</span>(enemy_list[i], enemy_list.<span class="built_in">back</span>());</span><br><span class="line">					enemy_list.<span class="built_in">pop_back</span>();</span><br><span class="line">					<span class="keyword">delete</span> enemy;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">cleardevice</span>();<span class="comment">//进行渲染</span></span><br><span class="line">		<span class="keyword">if</span> (is_game_started)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">putimage</span>(<span class="number">0</span>, <span class="number">0</span>, &amp;img_background);</span><br><span class="line">			player.<span class="built_in">Draw</span>(<span class="number">1000</span> / <span class="number">144</span>);</span><br><span class="line">			<span class="keyword">for</span> (Enemy* enemy : enemy_list)</span><br><span class="line">				enemy-&gt;<span class="built_in">Draw</span>(<span class="number">1000</span> / <span class="number">144</span>);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">const</span> Bullet&amp; bullet : bullet_list)</span><br><span class="line">				bullet.<span class="built_in">Draw</span>();</span><br><span class="line">			<span class="comment">//DrawPlayer(1000 / 144, is_move_right - is_move_left);</span></span><br><span class="line">			<span class="built_in">DrawPlayerScore</span>(score);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">putimage</span>(<span class="number">0</span>, <span class="number">0</span>, &amp;img_menu);</span><br><span class="line">			btn_start_game.<span class="built_in">Draw</span>();</span><br><span class="line">			btn_quit_game.<span class="built_in">Draw</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">FlushBatchDraw</span>();</span><br><span class="line">		DWORD end_time = <span class="built_in">GetTickCount</span>();</span><br><span class="line">		DWORD delta_time = end_time - start_time;</span><br><span class="line">		<span class="keyword">if</span> (delta_time &lt; <span class="number">1000</span> / <span class="number">144</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">Sleep</span>(<span class="number">1000</span> / <span class="number">144</span> - delta_time);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">delete</span> atlas_player_left;</span><br><span class="line">	<span class="keyword">delete</span> atlas_player_right;</span><br><span class="line">	<span class="keyword">delete</span> atlas_enemy_left;</span><br><span class="line">	<span class="keyword">delete</span> atlas_enemy_right;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">EndBatchDraw</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/avatar.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/avatar.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Lzcwbcgs</div><div class="post-copyright__author_desc">可我最爱是天然</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/01/18/C-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E6%8F%90%E7%93%A6%E7%89%B9%E5%B9%B8%E5%AD%98%E8%80%85/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/01/18/C-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E6%8F%90%E7%93%A6%E7%89%B9%E5%B9%B8%E5%AD%98%E8%80%85/')">C++游戏开发--提瓦特幸存者</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/01/18/C-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E6%8F%90%E7%93%A6%E7%89%B9%E5%B9%B8%E5%AD%98%E8%80%85/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=C++游戏开发--提瓦特幸存者&amp;url=http://example.com/2025/01/18/C-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E6%8F%90%E7%93%A6%E7%89%B9%E5%B9%B8%E5%AD%98%E8%80%85/&amp;pic=/images/text01.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/C/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>C++<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>游戏开发<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/easyx/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>easyx<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/images/text01.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2025/01/18/hello-world/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/helloword.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Hello World</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">Lzcwbcgs</h1><div class="author-info__desc">可我最爱是天然</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Lzcwbcgs" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1470321490" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(/images/card01.jpg) center center / 100% no-repeat"></div><div class="back face" style="background: url(/images/card02.jpg) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%8A%A8%E7%94%BB%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.</span> <span class="toc-text">一、动画系统设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 设计思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB-Atlas"><span class="toc-number">2.2.1.</span> <span class="toc-text">资源管理类 (Atlas)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB%E6%92%AD%E6%94%BE%E7%B1%BB-Animation"><span class="toc-number">2.2.2.</span> <span class="toc-text">动画播放类 (Animation)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%8E%A9%E5%AE%B6%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.</span> <span class="toc-text">二、玩家控制系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 设计思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E5%A4%84%E7%90%86"><span class="toc-number">3.2.1.</span> <span class="toc-text">输入处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E5%8A%A8%E8%AE%A1%E7%AE%97"><span class="toc-number">3.2.2.</span> <span class="toc-text">运动计算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86"><span class="toc-number">3.2.3.</span> <span class="toc-text">数学原理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%95%8C%E4%BA%BA%E7%94%9F%E6%88%90%E7%B3%BB%E7%BB%9F"><span class="toc-number">4.</span> <span class="toc-text">三、敌人生成系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-number">4.1.</span> <span class="toc-text">3.1 设计思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.</span> <span class="toc-text">3.2 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E4%BD%8D%E7%BD%AE%E8%AE%A1%E7%AE%97"><span class="toc-number">4.2.1.</span> <span class="toc-text">生成位置计算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%AF%BB%E8%B7%AF"><span class="toc-number">4.2.2.</span> <span class="toc-text">自动寻路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E7%89%B9%E7%82%B9"><span class="toc-number">4.2.3.</span> <span class="toc-text">算法特点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F"><span class="toc-number">5.</span> <span class="toc-text">四、碰撞检测系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 设计思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.2.</span> <span class="toc-text">4.2 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E5%BC%B9%E4%B8%8E%E6%95%8C%E4%BA%BA%E7%A2%B0%E6%92%9E"><span class="toc-number">5.2.1.</span> <span class="toc-text">子弹与敌人碰撞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%A9%E5%AE%B6%E4%B8%8E%E6%95%8C%E4%BA%BA%E7%A2%B0%E6%92%9E"><span class="toc-number">5.2.2.</span> <span class="toc-text">玩家与敌人碰撞</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81UI%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.</span> <span class="toc-text">五、UI系统设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-number">6.1.</span> <span class="toc-text">5.1 设计思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.2.</span> <span class="toc-text">5.2 代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E9%92%AE%E5%9F%BA%E7%B1%BB"><span class="toc-number">6.2.1.</span> <span class="toc-text">按钮基类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E6%B8%B8%E6%88%8F%E6%8C%89%E9%92%AE"><span class="toc-number">6.2.2.</span> <span class="toc-text">开始游戏按钮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9D%9F%E6%B8%B8%E6%88%8F%E6%8C%89%E9%92%AE"><span class="toc-number">6.2.3.</span> <span class="toc-text">结束游戏按钮</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%B8%B8%E6%88%8F%E5%BE%AA%E7%8E%AF%E6%9E%B6%E6%9E%84"><span class="toc-number">7.</span> <span class="toc-text">六、游戏循环架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E4%B8%BB%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84"><span class="toc-number">7.1.</span> <span class="toc-text">6.1 主循环结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%BA%90%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA"><span class="toc-number">8.</span> <span class="toc-text">七、源代码展示</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/18/C-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E6%8F%90%E7%93%A6%E7%89%B9%E5%B9%B8%E5%AD%98%E8%80%85/" title="C++游戏开发--提瓦特幸存者"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/text01.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C++游戏开发--提瓦特幸存者"/></a><div class="content"><a class="title" href="/2025/01/18/C-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E6%8F%90%E7%93%A6%E7%89%B9%E5%B9%B8%E5%AD%98%E8%80%85/" title="C++游戏开发--提瓦特幸存者">C++游戏开发--提瓦特幸存者</a><time datetime="2025-01-18T11:55:48.000Z" title="Created 2025-01-18 19:55:48">2025-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/18/hello-world/" title="Hello World"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/helloword.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2025/01/18/hello-world/" title="Hello World">Hello World</a><time datetime="2025-01-18T00:40:42.151Z" title="Created 2025-01-18 08:40:42">2025-01-18</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="Lzcwbcgs" target="_blank">Lzcwbcgs</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">2</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">4</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">2</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Blog/" style="font-size: 0.88rem;">Blog<sup>1</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>1</sup></a><a href="/tags/easyx/" style="font-size: 0.88rem;">easyx<sup>1</sup></a><a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">游戏开发<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("1/11/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Lzcwbcgs 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>